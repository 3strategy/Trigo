---
layout: default
title: Trigo Trainer
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
  <title>Triangle Trainer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background-color: #f0f0f0;
    }
    .italic {
      font-style: italic;
    }
    #canvas-container {
      position: relative;
      
      border: 1px solid #000;
      background-color: black;
    }
    canvas {
      display: block;
    }
    #answer-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0;
    }
    .btn {
      padding: 10px 15px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      background-color: #4285f4;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .btn:hover {
      background-color: #3367d6;
    }
    #status-message {

      font-size: 34px;
      font-weight: bold;
      text-align:center;
border: 1px solid #000;
      height: 30px;
      color: #333;
	  background-color:#000;
    }
    #results {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #fff;
      max-width: 400px;
      width: 100%;
    }
    #result-text {
      white-space: pre-line;
      font-size: 16px;
    }
    .device-toggle {
      margin-bottom: 20px;
    }
    .hidden {
      display: none;
    }
    #name-input {
      margin: 20px 0;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 250px;
    }
    button {
      padding: 15px 25px;
      font-size: 18px;
      background-color: #4682B4;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #36648B;
    }
    .math-button {
      display: inline-block;
      margin: 20px;
    }
    /* Increase the size of MathJax output */
    .MathJax {
      font-size: 180% !important;
    }
  </style>
</head>
<body>
  <h1>Triangle Trainer</h1>

  <!-- <div class="device-toggle">
    <label>
      <input type="radio" name="device" value="desktop" checked> Desktop
    </label>
    <label>
      <input type="radio" name="device" value="mobile"> Mobile
    </label>
  </div> -->

  <input type="text" id="name-input" placeholder="Enter your name (optional)">

  <div id="canvas-container">
    <canvas id="canvas"></canvas>
  </div>

  <div id="status-message"></div>

  <div id="answer-buttons" class="math-button">
    <button class="btn" data-value="1">\[a\sin\beta\]</button>
    <button class="btn" data-value="2">\[a\cos\beta\]</button>
    <button class="btn" data-value="11">\[\frac{a}{\sin\beta}\]</button>
    <button class="btn" data-value="22">\[\frac{a}{\cos\beta}\]</button>
    <button class="btn" data-value="9" style="background-color: #db4437;">Finish</button>
  </div>

  <div id="results" class="hidden">
    <h2>Results</h2>
    <div id="result-text"></div>
    <button id="restart-btn" class="btn" style="margin-top: 15px; background-color: #0f9d58;">Restart</button>
  </div>

  <script>
    window.onload = function() {
      MathJax.typeset();
    }

    document.addEventListener("DOMContentLoaded", function() {
      // Canvas setup
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const canvasContainer = document.getElementById("canvas-container");
      const statusMessage = document.getElementById("status-message");
      const resultsDiv = document.getElementById("results");
      const resultText = document.getElementById("result-text");
      const nameInput = document.getElementById("name-input");

      // Tracking variables
      let flag = true;
      let total = 0;
      let counter = 0;
      let timetaken = 0;
      let c1 = 0, c2 = 0, c11 = 0, c22 = 0;
      let t1 = 0, t2 = 0, t11 = 0, t22 = 0;
      let tm = 0, td = 0;
      let starttime = 0;
      let mobileMode = false;

      // Colors
      const cred = 'red';
      const cblue = 'blue';
      const cblack = 'black';
      const cgreen = 'lightgreen';

      // Set up canvas dimensions
      function setupCanvas() {
        let maxx = mobileMode ? 250 : 600;
        let maxy = mobileMode ? 350 : 500;
        canvas.width = maxx + 10;
		statusMessage.style.width = maxx +10+"px";
		statusMessage.style.height = 70+"px";
		
        canvas.height = maxy + 10;
        canvasContainer.style.width = canvas.width + "px";
        canvasContainer.style.height = canvas.height + "px";
        // Set background color
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      // Handle device toggle
      const deviceRadios = document.querySelectorAll('input[name="device"]');
      deviceRadios.forEach(function(radio) {
        radio.addEventListener("change", function(e) {
          mobileMode = e.target.value === 'mobile';
          setupCanvas();
          if (flag) {
            setTimeout(triangle1, 100); // Redraw triangle with new dimensions
          }
        });
      });

      // Initialize
      setupCanvas();

      // Helper functions
      function drawLine(x1, y1, x2, y2, color = cblue, width = mobileMode ? 2 : 4) {
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.strokeStyle = color;
        ctx.lineWidth = width;
        ctx.stroke();
      }

      function writeText(x, y, text, color = cblue) {
        const fontSize = mobileMode ? 48 : 50;
        const fontStyle = mobileMode ? 'italic' : 'italic';
        ctx.font = `${fontStyle} ${fontSize}px Arial`;
        ctx.fillStyle = color;
        ctx.fillText(text, x, y);
      }

      // Main triangle drawing function
      function triangle1() {
        if (!flag) return;
        // Clear canvas
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Set parameters
        const sinn = Math.random() > 0.5 ? 1 : 0;
        const is_division = Math.random() > 0.5 ? 1 : 0;
        const sc = mobileMode ? 0.4 : 1;
        const xora = is_division === 0 ? ['a', 'x?'] : ['x?', 'a'];

        // Set up coordinates for triangle points
        const maxx = mobileMode ? 250 : 700;
        const maxy = mobileMode ? 250 : 500;
        const oox = maxx / 2;
        const ooy = maxy / 2;

        let dx = (sc * 90 + (Math.random() - 0.5) * sc * 140) * (Math.random() > 0.5 ? -1 : 1);
        let l1 = Math.pow(Math.min(oox, ooy) * 1.2, 2);
        if (sc !== 1) l1 *= 0.7;
        let dy = Math.pow(l1 - dx * dx, 0.5) * (Math.random() > 0.5 ? -1 : 1);

        const ox = oox - 0.5 * dx;
        const oy = ooy - 0.5 * dy;
        const ratio = (0.55 + 0.25 * Math.random()) * (Math.random() > 0.5 ? -1 : 1);
        let xb, yb;
        if (sinn === 0) {
          xb = ox;
          yb = oy;
        }
        const x0 = ox + 0.5 * dx;
        const y0 = oy + 0.5 * dy;

        // First edge
        const mx = ox + dx;
        const my = oy + dy;
        if (mx < 0 || my < 0 || mx > maxx || my > maxy) {
          setTimeout(triangle1, 10);
          return;
        }
        drawLine(ox, oy, mx, my);

        // --- Draw the right-angle marker ---
        // Compute scaled leg components:
        const newDx = dx * ratio;
        const newDy = dy * ratio;
        const length2 = Math.sqrt(newDx * newDx + newDy * newDy);
        const k = sc * 20 / (length2 || 1);
        // not needed First marker segment: from (mx,my) in direction perpendicular to second leg.

        // Second segment: parallel to second leg.
        let Q_x, Q_y;
        if (ratio > 0) {
		  P_x = mx + k * newDy;
          P_y = my - k * newDx;
          Q_x = P_x - k * newDx;
          Q_y = P_y - k * newDy;
		  // Third segment: perpendicular to the previous direction.
		  R_x = Q_x - k * newDy;
		  R_y = Q_y + k * newDx;
        } else {
		  P_x = mx - k * newDy;
          P_y = my + k * newDx;
          Q_x = P_x + k * newDx;
          Q_y = P_y + k * newDy;
		  R_x = Q_x + k * newDy;
		  R_y = Q_y - k * newDx;
        }

        drawLine(mx, my, P_x, P_y, cred);
        drawLine(P_x, P_y, Q_x, Q_y, cred);
        drawLine(Q_x, Q_y, R_x, R_y, cred);

        // Second edge
        const mx2 = mx + newDy;
        const my2 = my - newDx;
        if (mx2 >= 10 && my2 >= 10 && mx2 <= maxx-20 && my2 <= maxy-20) {
          drawLine(mx, my, mx2, my2);
          if (sinn === 1) {
            xb = mx2;
            yb = my2;
          }
          const x1 = 0.5 * (ox + mx2);
          const y1 = 0.5 * (oy + my2);
          drawLine(ox, oy, mx2, my2);
          writeText(xb, yb, 'Î²', cgreen);
          writeText(x0, y0, xora[0], cred);
          writeText(x1, y1, xora[1], cred);
          // Determine correct answer
          let correct;
          if (is_division === 1) {
            correct = sinn === 1 ? 1 : 2;
          } else {
            correct = sinn === 1 ? 11 : 22;
          }
          canvas.dataset.correctAnswer = correct.toString();
          starttime = performance.now();
        } else {
          setTimeout(triangle1, 10);
        }
      }

      // Handle button clicks
      document.querySelectorAll('.btn').forEach(function(button) {
        button.addEventListener('click', function() {
          if (!flag) return;
          const value = parseInt(this.getAttribute('data-value') || '0');
          handleAnswer(value);
        });
      });

      function handleAnswer(ans) {
        if (!flag) return;
        const correct = parseInt(canvas.dataset.correctAnswer || '0');
        const elapsedTime = (performance.now() - starttime) / 1000;
        timetaken += elapsedTime;
        total += 1;
        if (total > 22 || timetaken > 360) {
          handleAnswer(9);
          return;
        }
        if (correct === 1 || correct === 2) {
          td += elapsedTime;
          if (correct === 1) {
            if (ans === correct) c1 += 1;
            if (ans !== 9) t1 += 1;
          } else {
            if (ans === correct) c2 += 1;
            if (ans !== 9) t2 += 1;
          }
        } else {
          tm += elapsedTime;
          if (correct === 11) {
            if (ans === correct) c11 += 1;
            if (ans !== 9) t11 += 1;
          } else {
            if (ans === correct) c22 += 1;
            if (ans !== 9) t22 += 1;
          }
        }
        if (ans === correct) {
          statusMessage.textContent = "Great!";
          statusMessage.style.color = cgreen;
          counter += 1;
          setTimeout(() => {
            statusMessage.textContent = "";
            triangle1();
          }, 2000);
        } else if (ans === 9) {
          flag = false;
          total -= 1;
          showResults();
        } else {
          statusMessage.textContent = "Incorrect";
          statusMessage.style.color = "gray";
          setTimeout(() => {
            statusMessage.textContent = "";
            triangle1();
          }, 2000);
        }
      }

      function showResults() {
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        const name = nameInput.value.trim() || "Anonymous";
        let resultString = `Thanks ${name}. ${counter} correct of ${total}\n`;
        resultString += `Avg response time is ${(timetaken/Math.max(1, total)).toFixed(1)}\n`;
        resultString += t1 > 0 ? `\n${c1} correct sin multiplications (${(100*c1/t1).toFixed(1)}%)` : `\nN/A correct sin multiplications (N/A%)`;
        resultString += t2 > 0 ? `\n${c2} correct cos multiplications (${(100*c2/t2).toFixed(1)}%)` : `\nN/A correct cos multiplications (N/A%)`;
        resultString += t11 > 0 ? `\n${c11} correct sin divisions (${(100*c11/t11).toFixed(1)}%)` : `\nN/A correct sin divisions (N/A%)`;
        resultString += t22 > 0 ? `\n${c22} correct cos divisions (${(100*c22/t22).toFixed(1)}%)` : `\nN/A correct cos divisions (N/A%)`;
        resultString += (t11+t22) > 0 ? `\nAvg time for divisions: ${(td/(t11+t22)).toFixed(1)}` : `\nAvg time for divisions: N/A`;
        resultString += (t1+t2) > 0 ? `\nAvg time for multiplications: ${(tm/(t1+t2)).toFixed(1)}` : `\nAvg time for multiplications: N/A`;
        resultText.textContent = resultString;
        resultsDiv.classList.remove("hidden");
        sendResultsToTelegram(resultString, name);
      }

      async function sendResultsToTelegram(results, name) {
        try {
            const message = `${results}\n${new Date().toLocaleString()}\n${name}\n${tm}, ${td}, ${timetaken}`;
            
            const response = await fetch("https://super-term-2809.3strategy.workers.dev/", { 
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message })
            });

            if (response.ok) {
                console.log("Results sent successfully");
            } else {
                console.error("Failed to send results:", await response.text());
            }
        } catch (error) {
            console.error("Failed to send results:", error);
        }
    }



      document.getElementById("restart-btn").addEventListener("click", function() {
        flag = true;
        total = 0;
        counter = 0;
        timetaken = 0;
        c1 = c2 = c11 = c22 = 0;
        t1 = t2 = t11 = t22 = 0;
        tm = td = 0;
        resultsDiv.classList.add("hidden");
        triangle1();
      });

      setTimeout(triangle1, 100);
    });
  </script>
  
</body>
</html>